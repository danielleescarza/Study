{% extends 'app/base.html' %}

{% block title %}
  Manage Accounts
{% endblock %}

{% block content %}
  <div class="dash-content">
    <div class="overview">
      <div class="title">
        <span class="text">Manage Accounts</span>
      </div>
      <div class="table_box">
        <div class="table_container">
          <div class="create_body">
            <div class="create">
              <form method="POST">
                {% csrf_token %}
                <div class="input-box">
                  <select id="user_type" name="user_type" required onchange="updateForm()">
                    <option value="" disabled selected>User Type</option>
                    <option value="student">Student</option>
                    <option value="employee">Employee</option>
                    <option value="admin">Admin</option>
                  </select>
                </div>
                <div class="input-group">
                  <div class="input-box">
                    <input type="text" class="input-field" id="uid" name="uid" placeholder="Tap ID" />
                  </div>
                  <div class="input-box">
                    <input type="text" class="input-field" id="student_number" name="student_number" placeholder="Student Number" min="1" required />
                  </div>
                </div>
                <div class="input-group">
                  <div class="input-box">
                    <input type="text" class="input-field" id="first_name" name="first_name" placeholder="First Name" required />
                  </div>
                  <div class="input-box">
                    <input type="text" class="input-field" id="last_name" name="last_name" placeholder="Last Name" required />
                  </div>
                </div>
                <div class="input-box">
                  <select id="department" name="department" required onchange="updateDepartment()">
                    <option value="BED">Basic Education Department</option>
                    <option value="BSN">Bachelor of Science in Nursing</option>
                    <option value="BSCS">Bachelor of Science in Computer Science</option>
                    <option value="BSA">Bachelor of Science in Accountancy</option>
                    <option value="BSBA">Bachelor of Science in Business Administration Major in Operational Management</option>
                    <option value="BSP">Bachelor of Science in Psychology</option>
                    <option value="BSRT">Bachelor of Science in Radiologic Technology</option>
                    <option value="BSHM">Bachelor of Science in Hospitality Management</option>
                    <option value="BEEd">Bachelor of Science in Elementary Education</option>
                    <option value="BSEd-Filipino">Bachelor of Science in Secondary Education Major in Filipino</option>
                    <option value="BSEd-English">Bachelor of Science in Secondary Education Major in English</option>
                    <option value="College">College Department</option>
                    <option value="Accounting">Accounting Department</option>
                    <option value="Office">Office of the President and CEO, COO</option>
                    <option value="Compliance">Compliance Department</option>
                    <option value="HumanResource">Human Resource Department</option>
                    <option value="HealthServices">Health Services Department</option>
                    <option value="ICT">ICT Department</option>
                    <option value="Guidance">Guidance Department</option>
                    <option value="Marketing">Marketing Department</option>
                    <option value="Procurement">Procurement Departmen</option>
                    <option value="Housekeeping">Housekeeping Department</option>
                    <option value="Security">Security Department</option>
                  </select>
                </div>
                <div class="input-box" id="level-container">
                  <select id="level" name="level" required>
                    <option value="nursery">Nursery</option>
                    <option value="kindergarten">Kindergarten</option>
                    <option value="1">Grade 1</option>
                    <option value="2">Grade 2</option>
                    <option value="3">Grade 3</option>
                    <option value="4">Grade 4</option>
                    <option value="5">Grade 5</option>
                    <option value="6">Grade 6</option>
                    <option value="7">Grade 7</option>
                    <option value="8">Grade 8</option>
                    <option value="9">Grade 9</option>
                    <option value="10">Grade 10</option>
                    <option value="11">Grade 11</option>
                    <option value="12">Grade 12</option>
                    <option value="first_year">1st Year</option>
                    <option value="second_year">2nd Year</option>
                    <option value="third_year">3rd Year</option>
                    <option value="fourth_year">4th Year</option>
                  </select>
                </div>
                <div class="input-box">
                  <input type="password" class="input-field" id="password1" name="password1" placeholder="Enter Password" required />
                </div>
                <div class="input-box">
                  <input type="password" class="input-field" id="password2" name="password2" placeholder="Confirm Password" required />
                </div>
                <div class="input-submit">
                  <button class="submit-btn" type="submit"><label>Create Account</label></button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    function updateForm() {
      const userType = document.getElementById('user_type').value;
      const studentNumberInput = document.getElementById('student_number');
      const levelContainer = document.getElementById('level-container');
      const levelSelect = document.getElementById('level');
      const departmentSelect = document.getElementById('department');

      // Reset all fields to default state
      studentNumberInput.placeholder = "Student Number";
      levelContainer.style.display = 'block'; // Show level
      levelSelect.required = true; // Make required
      Array.from(departmentSelect.options).forEach(option => {
        option.style.display = 'block'; // Show all options
      });

      if (userType === 'employee') {
        studentNumberInput.placeholder = "Username";
        levelContainer.style.display = 'none'; // Hide level
        levelSelect.required = false; // Remove required attribute
        // Hide specific department options
        Array.from(departmentSelect.options).forEach(option => {
          if (['BSN', 'BSCS', 'BSA', 'BSBA', 'BSP', 'BSRT', 'BSHM', 'BEEd', 'BSEd-Filipino', 'BSEd-English'].includes(option.value)) {
            option.style.display = 'none';
          }
        });
      } else if (userType === 'admin') {
        studentNumberInput.placeholder = "Username"; // Change placeholder for admin
        levelContainer.style.display = 'none'; // Hide level
        levelSelect.required = false; // Remove required attribute
        // Hide specific department options for admin
        Array.from(departmentSelect.options).forEach(option => {
          if (['BSN', 'BSCS', 'BSA', 'BSBA', 'BSP', 'BSRT', 'BSHM', 'BEEd', 'BSEd-Filipino', 'BSEd-English'].includes(option.value)) {
            option.style.display = 'none';
          }
        });
      }
    }

    function updateDepartment() {
      const department = document.getElementById('department').value;
      const levelSelect = document.getElementById('level');

      // Reset level options
      Array.from(levelSelect.options).forEach(option => {
        option.style.display = 'block'; // Show all initially
      });

      if (department === 'BED') {
        // Hide year options for BED
        Array.from(levelSelect.options).forEach(option => {
          if (['first_year', 'second_year', 'third_year', 'fourth_year'].includes(option.value)) {
            option.style.display = 'none';
          }
        });
      } else if (['BSN', 'BSCS', 'BSA', 'BSBA', 'BSP', 'BSRT', 'BSHM', 'BEEd', 'BSEd-Filipino', 'BSEd-English'].includes(department)) {
        // Hide grade options for these departments
        Array.from(levelSelect.options).forEach(option => {
          if (['nursery', 'kindergarten', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12'].includes(option.value)) {
            option.style.display = 'none';
          }
        });
      }
    }

    // Initialize form on page load to handle pre-selected values if any
    document.addEventListener('DOMContentLoaded', () => {
      updateForm();
      updateDepartment();
    });
  </script>
{% endblock %}
